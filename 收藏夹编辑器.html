<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>收藏夹编辑器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="编辑器.css">
    <style>
        /* 添加文本框样式 */
        .html-source-input {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
        }
        
        .html-source-input:focus {
            border-color: #4a6cf7;
            outline: none;
            box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1><i class="fas fa-bookmark"></i> 收藏夹编辑器</h1>
            <p>创建并管理您的个性化收藏夹网页，轻松添加、编辑和整理常用链接</p>
        </div>
        
        <!-- 修改后的导入区域 - 使用文本输入框 -->
        <div class="drop-zone" id="dropZone">
            <i class="fas fa-code"></i>
            <h3>粘贴HTML源代码</h3>
            <p>将您的收藏夹HTML源代码粘贴到下方输入框</p>
            
            <textarea id="htmlSourceInput" class="html-source-input" placeholder="在此处粘贴HTML代码..."></textarea>
            
            <button class="btn-outline" id="importHtmlBtn">
                <i class="fas fa-file-import"></i> 导入HTML
            </button>
            <p class="note">提示：在浏览器中打开收藏夹页面，右键选择"查看页面源代码"，复制所有内容并粘贴到上方文本框。</p>
        </div>
        
        <!-- 主编辑区 -->
        <div class="editor-container">
            <!-- 预览面板 -->
            <div class="preview-panel">
                <h2><i class="fas fa-eye"></i> 预览</h2>
                <div class="favorites-container" id="previewContent">
                    <!-- 预览内容将通过JavaScript动态生成 -->
                </div>
            </div>
            
            <!-- 编辑面板 -->
            <div class="edit-panel">
                <!-- 区域管理 -->
                <div class="section-editor">
                    <div class="section-header">
                        <h3><i class="fas fa-folder"></i> 区域管理</h3>
                        <div class="section-controls">
                            <button id="addSectionBtn">
                                <i class="fas fa-plus"></i> 添加区域
                            </button>
                            <button id="toggleSectionSortBtn" class="btn-outline">
                                <i class="fas fa-sort"></i> 排序
                            </button>
                        </div>
                    </div>
                    
                    <div id="sectionList" class="section-sortable">
                        <!-- 区域将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <!-- 按钮管理 -->
                <div class="section-editor">
                    <div class="section-header">
                        <h3><i class="fas fa-link"></i> 按钮管理</h3>
                        <div class="section-controls">
                            <button id="addButtonBtn">
                                <i class="fas fa-plus"></i> 添加按钮
                            </button>
                            <button id="toggleButtonSortBtn" class="btn-outline">
                                <i class="fas fa-sort"></i> 排序
                            </button>
                        </div>
                    </div>
                    
                    <!-- 区域筛选器 -->
                    <div class="section-filter">
                        <label>筛选区域:</label>
                        <select id="sectionFilter">
                            <option value="all">所有区域</option>
                            <!-- 区域选项将通过JavaScript动态生成 -->
                        </select>
                    </div>
                    
                    <div class="button-list button-sortable" id="buttonList">
                        <!-- 按钮将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 输出区域 -->
        <div class="output-container">
            <div class="output-header">
                <h3><i class="fas fa-code"></i> 生成的HTML代码</h3>
                <div class="section-controls">
                    <button class="btn-success" id="generateBtn">
                        <i class="fas fa-sync-alt"></i> 生成代码
                    </button>
                </div>
            </div>
            
            <textarea id="htmlOutput" readonly></textarea>
            
            <div class="btn-group">
                <button class="btn-info" id="copyBtn">
                    <i class="fas fa-copy"></i> 复制到剪贴板
                </button>
                <button class="btn-outline" id="resetBtn">
                    <i class="fas fa-redo"></i> 重置编辑器
                </button>
            </div>
        </div>
        
        <!-- 页脚 -->
        <div class="footer">
            <p>© 2023 收藏夹编辑器 | 轻松创建和管理您的个人收藏夹</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <script>
        // 数据结构
        let sections = [
            {
                id: 'docs',
                title: '文档',
                icon: 'fas fa-file-alt',
                description: '常用文档资源'
            },
            {
                id: 'tools',
                title: '工具',
                icon: 'fas fa-tools',
                description: '实用在线工具'
            }
        ];
        
        let buttons = [
            {
                id: 'doc1',
                section: 'docs',
                title: 'MDN文档',
                content: 'Web开发技术文档',
                icon: 'fab fa-md',
                link: 'https://developer.mozilla.org/'
            },
            {
                id: 'doc2',
                section: 'docs',
                title: 'GitHub',
                content: '代码托管平台',
                icon: 'fab fa-github',
                link: 'https://github.com/'
            },
            {
                id: 'tool1',
                section: 'tools',
                title: 'JSON格式化',
                content: '在线JSON工具',
                icon: 'fas fa-code',
                link: 'https://jsonformatter.org/'
            },
            {
                id: 'tool2',
                section: 'tools',
                title: '颜色选择器',
                content: '在线颜色工具',
                icon: 'fas fa-palette',
                link: 'https://htmlcolorcodes.com/'
            }
        ];
        
        // 当前选中的区域和按钮
        let currentSection = null;
        let currentButton = null;
        let currentFilter = 'all'; // 当前筛选条件
        let hasUnsavedChanges = false; // 跟踪未保存的更改
        
        // 排序状态
        let isSectionSorting = false;
        let isButtonSorting = false;
        
        // Sortable实例
        let sectionSortable = null;
        let buttonSortable = null;
        
        // 存储导入的HTML结构信息
        let importedHtmlStructure = {
            head: '',
            header: '',
            footer: '',
            styles: '',
            bodyClasses: '',
            containerClasses: ''
        };
        
        // 常用图标列表
        const commonIcons = [
            'fas fa-link', 'fas fa-file-alt', 'fas fa-book', 'fas fa-tools', 
            'fas fa-cog', 'fas fa-palette', 'fas fa-code', 'fas fa-image', 
            'fas fa-video', 'fas fa-music', 'fas fa-envelope', 'fas fa-calendar',
            'fas fa-map-marker', 'fas fa-globe', 'fas fa-database', 'fas fa-server',
            'fab fa-google', 'fab fa-github', 'fab fa-youtube', 'fab fa-twitter'
        ];
        
        // 标记有未保存的更改
        function markUnsavedChanges() {
            hasUnsavedChanges = true;
        }
        
        // 渲染区域列表
        function renderSections() {
            const container = document.getElementById('sectionList');
            container.innerHTML = '';
            
            sections.forEach(section => {
                const sectionEl = document.createElement('div');
                sectionEl.className = 'button-item';
                sectionEl.setAttribute('data-id', section.id);
                sectionEl.innerHTML = `
                    <div class="button-header">
                        <h4><span class="drag-handle"><i class="fas fa-grip-vertical"></i></span><i class="${section.icon}"></i> ${section.title}</h4>
                        <div class="button-actions">
                            <button class="btn-outline" onclick="editSection('${section.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="deleteSection('${section.id}')" ${sections.length <= 1 ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p>${section.description || '暂无描述'}</p>
                `;
                container.appendChild(sectionEl);
            });
            
            // 初始化或重新初始化排序功能
            initSectionSortable();
        }
        
        // 初始化区域排序功能
        function initSectionSortable() {
            const container = document.getElementById('sectionList');
            
            // 如果已存在Sortable实例，则销毁它
            if (sectionSortable) {
                sectionSortable.destroy();
            }
            
            // 只有在排序模式下才启用排序
            if (isSectionSorting) {
                sectionSortable = new Sortable(container, {
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    chosenClass: 'sortable-chosen',
                    dragClass: 'sortable-drag',
                    handle: '.drag-handle',
                    onEnd: function(evt) {
                        // 更新sections数组的顺序
                        const newIndex = evt.newIndex;
                        const oldIndex = evt.oldIndex;
                        
                        if (newIndex !== oldIndex) {
                            const movedItem = sections[oldIndex];
                            sections.splice(oldIndex, 1);
                            sections.splice(newIndex, 0, movedItem);
                            markUnsavedChanges();
                            updatePreview();
                        }
                    }
                });
            }
        }
        
        // 初始化按钮排序功能
        function initButtonSortable() {
            const container = document.getElementById('buttonList');
            
            // 如果已存在Sortable实例，则销毁它
            if (buttonSortable) {
                buttonSortable.destroy();
            }
            
            // 只有在排序模式下才启用排序
            if (isButtonSorting) {
                buttonSortable = new Sortable(container, {
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    chosenClass: 'sortable-chosen',
                    dragClass: 'sortable-drag',
                    handle: '.drag-handle',
                    onEnd: function(evt) {
                        // 更新buttons数组的顺序
                        const newIndex = evt.newIndex;
                        const oldIndex = evt.oldIndex;
                        
                        if (newIndex !== oldIndex) {
                            // 获取当前显示的按钮（已筛选）
                            let filteredButtons = buttons;
                            if (currentFilter !== 'all') {
                                filteredButtons = buttons.filter(button => button.section === currentFilter);
                            }
                            
                            // 找到移动的按钮ID
                            const movedButtonId = filteredButtons[oldIndex].id;
                            
                            // 找到该按钮在完整buttons数组中的索引
                            const fullIndex = buttons.findIndex(b => b.id === movedButtonId);
                            
                            if (fullIndex !== -1) {
                                // 从原位置移除
                                const movedItem = buttons[fullIndex];
                                buttons.splice(fullIndex, 1);
                                
                                // 计算在新顺序中的位置
                                let newFullIndex = 0;
                                if (newIndex > 0) {
                                    // 找到新位置前一个按钮在完整数组中的索引
                                    const prevButtonId = filteredButtons[newIndex - 1].id;
                                    const prevIndex = buttons.findIndex(b => b.id === prevButtonId);
                                    newFullIndex = prevIndex + 1;
                                }
                                
                                // 插入到新位置
                                buttons.splice(newFullIndex, 0, movedItem);
                                markUnsavedChanges();
                                updatePreview();
                            }
                        }
                    }
                });
            }
        }
        
        // 切换区域排序模式
        function toggleSectionSort() {
            isSectionSorting = !isSectionSorting;
            document.getElementById('toggleSectionSortBtn').innerHTML = 
                isSectionSorting ? 
                '<i class="fas fa-check"></i> 完成排序' : 
                '<i class="fas fa-sort"></i> 排序';
                
            document.getElementById('toggleSectionSortBtn').className = 
                isSectionSorting ? 'btn-success' : 'btn-outline';
                
            initSectionSortable();
        }
        
        // 切换按钮排序模式
        function toggleButtonSort() {
            isButtonSorting = !isButtonSorting;
            document.getElementById('toggleButtonSortBtn').innerHTML = 
                isButtonSorting ? 
                '<i class="fas fa-check"></i> 完成排序' : 
                '<i class="fas fa-sort"></i> 排序';
                
            document.getElementById('toggleButtonSortBtn').className = 
                isButtonSorting ? 'btn-success' : 'btn-outline';
                
            initButtonSortable();
        }
        
        // 更新区域筛选器
        function updateSectionFilter() {
            const filter = document.getElementById('sectionFilter');
            // 保留"所有区域"选项
            const allOption = filter.querySelector('option[value="all"]');
            filter.innerHTML = '';
            filter.appendChild(allOption);
            
            // 添加区域选项
            sections.forEach(section => {
                const option = document.createElement('option');
                option.value = section.id;
                option.textContent = section.title;
                filter.appendChild(option);
            });
        }
        
        // 渲染按钮列表
        function renderButtons() {
            const container = document.getElementById('buttonList');
            container.innerHTML = '';
            
            // 根据筛选条件过滤按钮
            let filteredButtons = buttons;
            if (currentFilter !== 'all') {
                filteredButtons = buttons.filter(button => button.section === currentFilter);
            }
            
            if (filteredButtons.length === 0) {
                container.innerHTML = `
                    <div class="button-item" style="text-align: center; padding: 30px;">
                        <i class="fas fa-link" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                        <h3>暂无按钮</h3>
                        <p>点击"添加按钮"开始创建</p>
                    </div>
                `;
                return;
            }
            
            filteredButtons.forEach(button => {
                const section = sections.find(s => s.id === button.section);
                const buttonEl = document.createElement('div');
                buttonEl.className = 'button-item';
                buttonEl.setAttribute('data-id', button.id);
                buttonEl.innerHTML = `
                    <div class="button-header">
                        <h4><span class="drag-handle"><i class="fas fa-grip-vertical"></i></span><i class="${button.icon}"></i> ${button.title}</h4>
                        <div class="button-actions">
                            <span class="tag" style="background: #eef2ff; color: #4a6cf7; padding: 4px 10px; border-radius: 20px; font-size: 0.85rem;">
                                <i class="${section.icon}"></i> ${section.title}
                            </span>
                            <button class="btn-outline" onclick="editButton('${button.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="deleteButton('${button.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p>${button.content}</p>
                    <a href="${button.link}" target="_blank" style="display: block; margin-top: 10px; color: #4a6cf7; font-size: 0.9rem;">
                        <i class="fas fa-external-link-alt"></i> ${button.link}
                    </a>
                `;
                container.appendChild(buttonEl);
            });
            
            // 初始化或重新初始化排序功能
            initButtonSortable();
        }
        
        // 更新预览
        function updatePreview() {
            const previewContent = document.getElementById('previewContent');
            
            if (sections.length === 0) {
                previewContent.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px; color: #6c757d;">
                        <i class="fas fa-bookmark" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.2;"></i>
                        <h3>暂无内容</h3>
                        <p>添加区域和按钮后，将在此处显示预览</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            sections.forEach(section => {
                const sectionButtons = buttons.filter(b => b.section === section.id);
                
                html += `
                    <section class="section">
                        <h2 class="section-title">
                            <i class="${section.icon}"></i> ${section.title}
                        </h2>
                        <div class="link-grid">
                `;
                
                if (sectionButtons.length === 0) {
                    html += `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 30px; background: #f8f9fa; border-radius: 10px;">
                            <i class="fas fa-link" style="font-size: 2.5rem; color: #ddd; margin-bottom: 15px;"></i>
                            <h3>此区域暂无按钮</h3>
                            <p>添加按钮后，将在此处显示</p>
                        </div>
                    `;
                } else {
                    sectionButtons.forEach(button => {
                        html += `
                            <div class="link-card">
                                <a href="${button.link}" target="_blank">
                                    <div class="link-icon">
                                        <i class="${button.icon}"></i>
                                    </div>
                                    <div class="link-content">
                                        <h3>${button.title}</h3>
                                        <p>${button.content}</p>
                                    </div>
                                </a>
                            </div>
                        `;
                    });
                }
                
                html += `
                        </div>
                    </section>
                `;
            });
            
            previewContent.innerHTML = html;
        }
        
        // 显示区域表单
        function showSectionForm(section = null) {
            // 退出排序模式
            if (isSectionSorting) {
                toggleSectionSort();
            }
            
            currentSection = section ? {...section} : null;
            
            const container = document.getElementById('sectionList');
            container.innerHTML = `
                <div class="button-item">
                    <h4><i class="fas fa-folder-plus"></i> ${section ? '编辑区域' : '添加新区域'}</h4>
                    <div class="form-group">
                        <label>区域名称</label>
                        <input type="text" id="sectionTitle" value="${section ? section.title : ''}" placeholder="例如：学习资源">
                    </div>
                    <div class="form-group">
                        <label>图标选择</label>
                        <div class="icon-selector">
                            ${commonIcons.map(icon => `
                                <div class="icon-option ${section && section.icon === icon ? 'selected' : ''}" data-icon="${icon}" onclick="selectIcon(this, 'section')">
                                    <i class="${icon}"></i>
                                </div>
                            `).join('')}
                        </div>
                        <input type="text" id="sectionIcon" value="${section ? section.icon : 'fas fa-folder'}" placeholder="例如：fas fa-book" style="margin-top: 10px;">
                    </div>
                    <div class="form-group">
                        <label>描述</label>
                        <input type="text" id="sectionDesc" value="${section ? section.description || '' : ''}" placeholder="区域简要描述">
                    </div>
                    <div class="btn-group">
                        <button class="btn-success" onclick="saveSection()">
                            <i class="fas fa-save"></i> 保存
                        </button>
                        <button class="btn-outline" onclick="renderSections()">
                            <i class="fas fa-times"></i> 取消
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 选择图标
        function selectIcon(element, type) {
            const icon = element.getAttribute('data-icon');
            
            // 移除所有选中状态
            document.querySelectorAll(`.icon-option.selected`).forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // 设置当前选中
            element.classList.add('selected');
            
            // 更新输入框
            if (type === 'section') {
                document.getElementById('sectionIcon').value = icon;
            } else {
                document.getElementById('buttonIcon').value = icon;
            }
        }
        
        // 保存区域
        function saveSection() {
            const title = document.getElementById('sectionTitle').value.trim();
            const icon = document.getElementById('sectionIcon').value.trim();
            const description = document.getElementById('sectionDesc').value.trim();
            
            if (!title) {
                alert('请填写区域名称');
                return;
            }
            
            if (!icon) {
                alert('请选择图标');
                return;
            }
            
            if (currentSection) {
                // 更新现有区域
                const index = sections.findIndex(s => s.id === currentSection.id);
                if (index !== -1) {
                    sections[index] = {
                        ...sections[index],
                        title,
                        icon,
                        description
                    };
                }
            } else {
                // 添加新区域
                sections.push({
                    id: 'section' + Date.now(),
                    title,
                    icon,
                    description
                });
            }
            
            markUnsavedChanges();
            renderSections();
            updateSectionFilter();
            updatePreview();
        }
        
        // 编辑区域
        function editSection(sectionId) {
            const section = sections.find(s => s.id === sectionId);
            if (section) showSectionForm(section);
        }
        
        // 删除区域
        function deleteSection(sectionId) {
            if (sections.length <= 1) {
                alert('必须保留至少一个区域');
                return;
            }
            
            if (!confirm('确定要删除此区域吗？此操作将同时删除该区域下的所有按钮。')) {
                return;
            }
            
            // 删除区域
            sections = sections.filter(s => s.id !== sectionId);
            
            // 删除关联按钮
            buttons = buttons.filter(b => b.section !== sectionId);
            
            markUnsavedChanges();
            renderSections();
            updateSectionFilter();
            renderButtons();
            updatePreview();
        }
        
        // 显示按钮表单
        function showButtonForm(button = null) {
            // 退出排序模式
            if (isButtonSorting) {
                toggleButtonSort();
            }
            
            currentButton = button ? {...button} : null;
            
            // 确定默认区域 - 修复部分：使用当前筛选的区域
            let defaultSection = currentFilter !== 'all' ? currentFilter : (sections.length > 0 ? sections[0].id : '');
            
            const container = document.getElementById('buttonList');
            container.innerHTML = `
                <div class="button-item">
                    <h4><i class="fas fa-plus-circle"></i> ${button ? '编辑按钮' : '添加新按钮'}</h4>
                    
                    <div class="form-group">
                        <label>所属区域</label>
                        <select id="buttonSection">
                            ${sections.map(s => 
                                `<option value="${s.id}" ${(button && button.section === s.id) || (!button && defaultSection === s.id) ? 'selected' : ''}>
                                    ${s.title}
                                </option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>标题</label>
                            <input type="text" id="buttonTitle" value="${button ? button.title : ''}" placeholder="按钮标题">
                        </div>
                        <div class="form-group">
                            <label>图标选择</label>
                            <div class="icon-selector">
                                ${commonIcons.map(icon => `
                                    <div class="icon-option ${button && button.icon === icon ? 'selected' : ''}" data-icon="${icon}" onclick="selectIcon(this, 'button')">
                                        <i class="${icon}"></i>
                                    </div>
                                `).join('')}
                            </div>
                            <input type="text" id="buttonIcon" value="${button ? button.icon : 'fas fa-link'}" placeholder="例如：fab fa-google" style="margin-top: 10px;">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>描述</label>
                        <textarea id="buttonContent" rows="2" placeholder="按钮描述">${button ? button.content : ''}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>链接地址</label>
                        <input type="text" id="buttonLink" value="${button ? button.link : ''}" placeholder="可以是任意内容">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn-success" onclick="saveButton()">
                            <i class="fas fa-save"></i> 保存
                        </button>
                        <button class="btn-outline" onclick="renderButtons()">
                            <i class="fas fa-times"></i> 取消
                        </button>
                    </div>
                </div>
            `;
        }
        
        // 保存按钮
        function saveButton() {
            const section = document.getElementById('buttonSection').value;
            const title = document.getElementById('buttonTitle').value.trim();
            const icon = document.getElementById('buttonIcon').value.trim();
            const content = document.getElementById('buttonContent').value.trim();
            const link = document.getElementById('buttonLink').value.trim();
            
            if (!title) {
                alert('请填写按钮标题');
                return;
            }
            
            if (!icon) {
                alert('请选择图标');
                return;
            }
            
            if (!link) {
                alert('请输入链接地址');
                return;
            }
            
            if (currentButton) {
                // 更新现有按钮
                const index = buttons.findIndex(b => b.id === currentButton.id);
                if (index !== -1) {
                    buttons[index] = {
                        ...buttons[index],
                        section,
                        title,
                        icon,
                        content,
                        link
                    };
                }
            } else {
                // 添加新按钮
                buttons.push({
                    id: 'button' + Date.now(),
                    section,
                    title,
                    icon,
                    content,
                    link
                });
            }
            
            markUnsavedChanges();
            renderButtons();
            updatePreview();
        }
        
        // 编辑按钮
        function editButton(buttonId) {
            const button = buttons.find(b => b.id === buttonId);
            if (button) showButtonForm(button);
        }
        
        // 删除按钮
        function deleteButton(buttonId) {
            if (!confirm('确定要删除此按钮吗？')) {
                return;
            }
            
            buttons = buttons.filter(b => b.id !== buttonId);
            markUnsavedChanges();
            renderButtons();
            updatePreview();
        }
        
        // 提取HTML结构信息
        function extractHtmlStructure(doc) {
            // 提取head内容（除了title和viewport）
            const head = doc.head;
            let headContent = '';
            for (let i = 0; i < head.children.length; i++) {
                const child = head.children[i];
                if (child.tagName !== 'TITLE' && 
                    !(child.tagName === 'META' && child.getAttribute('name') === 'viewport')) {
                    headContent += child.outerHTML + '\n    ';
                }
            }
            
            // 提取header和footer内容
            const header = doc.querySelector('header');
            const footer = doc.querySelector('footer');
            
            // 提取body的class
            const bodyClasses = doc.body.getAttribute('class') || '';
            
            // 提取容器元素的class
            const container = doc.querySelector('.container');
            const containerClasses = container ? container.getAttribute('class') || '' : '';
            
            // 保存提取的信息
            importedHtmlStructure = {
                head: headContent,
                header: header ? header.outerHTML : '',
                footer: footer ? footer.outerHTML : '',
                styles: '',
                bodyClasses: bodyClasses,
                containerClasses: containerClasses
            };
        }
        
        // 解析收藏夹内容
        function parseFavoritesContent(doc) {
            // 清空现有数据
            sections = [];
            buttons = [];
            
            // 解析区域
            const sectionElements = doc.querySelectorAll('.section');
            sectionElements.forEach(sectionEl => {
                const titleEl = sectionEl.querySelector('.section-title');
                if (titleEl) {
                    const iconEl = titleEl.querySelector('i');
                    const sectionId = 'section' + Date.now() + Math.random().toString(36).substr(2, 5);
                    
                    sections.push({
                        id: sectionId,
                        title: titleEl.textContent.replace(iconEl ? iconEl.outerHTML : '', '').trim(),
                        icon: iconEl ? iconEl.className : 'fas fa-folder',
                        description: ''
                    });
                    
                    // 解析该区域下的按钮
                    const buttonElements = sectionEl.querySelectorAll('.link-card');
                    buttonElements.forEach(buttonEl => {
                        const linkEl = buttonEl.querySelector('a');
                        if (linkEl) {
                            const iconEl = linkEl.querySelector('.link-icon i');
                            const contentEl = linkEl.querySelector('.link-content');
                            
                            buttons.push({
                                id: 'button' + Date.now() + Math.random().toString(36).substr(2, 5),
                                section: sectionId,
                                title: contentEl ? contentEl.querySelector('h3')?.textContent?.trim() || '未命名' : '未命名',
                                content: contentEl ? contentEl.querySelector('p')?.textContent?.trim() || '' : '',
                                icon: iconEl ? iconEl.className : 'fas fa-link',
                                link: linkEl.getAttribute('href') || '#'
                            });
                        }
                    });
                }
            });
            
            // 更新UI
            renderSections();
            updateSectionFilter();
            renderButtons();
            updatePreview();
            markUnsavedChanges();
        }
        
        // 生成的HTML代码
        function generateHtml() {
            let html = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的收藏夹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    ${importedHtmlStructure.head}
    <style>
        /* 这里是样式代码 */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7ff;
            color: #333;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .section {
            margin-bottom: 40px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .section-title {
            font-size: 1.8rem;
            color: #4a6cf7;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .link-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .link-card {
            background: #f8f9ff;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .link-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(74, 108, 247, 0.15);
        }
        
        .link-card a {
            display: block;
            padding: 20px;
            text-decoration: none;
            color: inherit;
        }
        
        .link-icon {
            font-size: 2.5rem;
            color: #4a6cf7;
            margin-bottom: 15px;
        }
        
        .link-content h3 {
            margin: 0;
            font-size: 1.3rem;
            color: #1a1a1a;
        }
        
        .link-content p {
            margin: 8px 0 0;
            color: #666;
            font-size: 0.95rem;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="${importedHtmlStructure.bodyClasses}">
    ${importedHtmlStructure.header || ''}
    <div class="container ${importedHtmlStructure.containerClasses}">
        <!-- 动态生成收藏夹内容 -->
`;

            sections.forEach(section => {
                const sectionButtons = buttons.filter(b => b.section === section.id);
                
                html += `        <section class="section">
            <h2 class="section-title">
                <i class="${section.icon}"></i> ${section.title}
            </h2>
            <div class="link-grid">
`;
                
                if (sectionButtons.length === 0) {
                    html += `                <div class="link-card" style="grid-column: 1 / -1; text-align: center; padding: 30px;">
                    <i class="fas fa-link" style="font-size: 2.5rem; color: #ddd; margin-bottom: 15px;"></i>
                    <h3>此区域暂无链接</h3>
                    <p>添加链接后，将在此处显示</p>
                </div>
`;
                } else {
                    sectionButtons.forEach(button => {
                        html += `                <div class="link-card">
                    <a href="${button.link}" target="_blank">
                        <div class="link-icon">
                            <i class="${button.icon}"></i>
                        </div>
                        <div class="link-content">
                            <h3>${button.title}</h3>
                            <p>${button.content}</p>
                        </div>
                    </a>
                </div>
`;
                    });
                }
                
                html += `            </div>
        </section>
`;
            });
            
            html += `    </div>
    ${importedHtmlStructure.footer || ''}
</body>
</html>`;
            
            return html;
        }
        
        // 初始化事件监听器
        function initEventListeners() {
            // 添加区域按钮
            document.getElementById('addSectionBtn').addEventListener('click', function() {
                showSectionForm();
            });
            
            // 添加按钮按钮
            document.getElementById('addButtonBtn').addEventListener('click', function() {
                showButtonForm();
            });
            
            // 区域筛选器
            document.getElementById('sectionFilter').addEventListener('change', function() {
                currentFilter = this.value;
                renderButtons();
            });
            
            // 切换区域排序按钮
            document.getElementById('toggleSectionSortBtn').addEventListener('click', toggleSectionSort);
            
            // 切换按钮排序按钮
            document.getElementById('toggleButtonSortBtn').addEventListener('click', toggleButtonSort);
            
            // 生成代码按钮
            document.getElementById('generateBtn').addEventListener('click', function() {
                document.getElementById('htmlOutput').value = generateHtml();
            });
            
            // 复制按钮
            document.getElementById('copyBtn').addEventListener('click', function() {
                const output = document.getElementById('htmlOutput');
                output.select();
                document.execCommand('copy');
                alert('代码已复制到剪贴板！');
            });
            
            // 重置按钮
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (confirm('确定要重置编辑器吗？所有未保存的更改都将丢失。')) {
                    sections = [
                        {
                            id: 'docs',
                            title: '文档',
                            icon: 'fas fa-file-alt',
                            description: '常用文档资源'
                        },
                        {
                            id: 'tools',
                            title: '工具',
                            icon: 'fas fa-tools',
                            description: '实用在线工具'
                        }
                    ];
                    
                    buttons = [
                        {
                            id: 'doc1',
                            section: 'docs',
                            title: 'MDN文档',
                            content: 'Web开发技术文档',
                            icon: 'fab fa-md',
                            link: 'https://developer.mozilla.org/'
                        },
                        {
                            id: 'doc2',
                            section: 'docs',
                            title: 'GitHub',
                            content: '代码托管平台',
                            icon: 'fab fa-github',
                            link: 'https://github.com/'
                        },
                        {
                            id: 'tool1',
                            section: 'tools',
                            title: 'JSON格式化',
                            content: '在线JSON工具',
                            icon: 'fas fa-code',
                            link: 'https://jsonformatter.org/'
                        },
                        {
                            id: 'tool2',
                            section: 'tools',
                            title: '颜色选择器',
                            content: '在线颜色工具',
                            icon: 'fas fa-palette',
                            link: 'https://htmlcolorcodes.com/'
                        }
                    ];
                    
                    importedHtmlStructure = {
                        head: '',
                        header: '',
                        footer: '',
                        styles: '',
                        bodyClasses: '',
                        containerClasses: ''
                    };
                    
                    currentFilter = 'all';
                    document.getElementById('sectionFilter').value = 'all';
                    
                    renderSections();
                    updateSectionFilter();
                    renderButtons();
                    updatePreview();
                    document.getElementById('htmlOutput').value = '';
                    
                    alert('编辑器已重置！');
                }
            });
            
            // 导入HTML按钮
            document.getElementById('importHtmlBtn').addEventListener('click', function() {
                const htmlSource = document.getElementById('htmlSourceInput').value.trim();
                
                if (!htmlSource) {
                    alert('请粘贴HTML源代码到输入框');
                    return;
                }
                
                try {
                    // 使用DOMParser解析HTML字符串
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(htmlSource, 'text/html');
                    
                    // 提取HTML结构信息
                    extractHtmlStructure(doc);
                    
                    // 尝试解析收藏夹内容（区域和按钮）
                    parseFavoritesContent(doc);
                    
                    alert('HTML导入成功！');
                } catch (error) {
                    console.error('HTML解析错误:', error);
                    alert('导入失败：HTML格式不正确或包含错误');
                }
            });
        }
        
        // 初始化应用
        function initApp() {
            renderSections();
            updateSectionFilter();
            renderButtons();
            updatePreview();
            initEventListeners();
        }
        
        // 启动应用
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
